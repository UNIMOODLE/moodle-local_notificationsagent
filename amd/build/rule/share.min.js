define("local_notificationsagent/rule/share",["exports","core/str","core/notification","core/modal_factory","core/modal_events","core/templates","local_notificationsagent/rule/repository"],(function(_exports,_str,_notification,_modal_factory,_modal_events,_templates,_repository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Version details
   *
   * @copyright  2023 Proyecto UNIMOODLE
   * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
   * @author     ISYC <soporte@isyc.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_templates=_interopRequireDefault(_templates);const SHARING_TYPE_SHARED=0,SHARING_TYPE_UNSHARED=1,selectors_shareRuleId='[id^="share-rule-"]:not(.disabled)',selectors_shareRuleDataShared="data-shared";_exports.init=async()=>{document.querySelectorAll(selectors_shareRuleId).forEach((shareItem=>{shareItem.addEventListener("click",(async function(){await showModal(shareItem)}))}))};const showModal=async shareItem=>{let ruleObj={};ruleObj.id=shareItem.dataset.ruleid,ruleObj.title=document.querySelector("#card-"+ruleObj.id+" .name").textContent,ruleObj.shared=shareItem.dataset.shared==SHARING_TYPE_SHARED?SHARING_TYPE_SHARED:SHARING_TYPE_UNSHARED,ruleObj.shared?ruleObj.name=await(0,_str.get_string)("sharetitle","local_notificationsagent",ruleObj):ruleObj.name=await(0,_str.get_string)("unsharetitle","local_notificationsagent",ruleObj),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:ruleObj.name,body:_templates.default.render("local_notificationsagent/modal/share",{rule:ruleObj})}).then((function(modal){let isShared=ruleObj.shared?SHARING_TYPE_SHARED:SHARING_TYPE_UNSHARED,shareBtnText=isShared?(0,_str.get_string)("editrule_unsharerule","local_notificationsagent"):(0,_str.get_string)("editrule_sharerule","local_notificationsagent");return modal.setSaveButtonText(shareBtnText),modal.getRoot().on(_modal_events.default.save,(function(){setRuleShare(ruleObj.id,isShared)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),!0}))},setRuleShare=async(id,shared)=>{try{let response=await(0,_repository.updateRuleShare)(id,shared);if($.isEmptyObject(response.warnings)){let shareItem=document.querySelector("a#share-rule-"+id),shareItemIcon=document.createElement("i"),shareItemText="",shareItemMessage="",shareItemTag=document.querySelector("div#card-"+id).querySelector("span.badge");shared?(shareItemTag.textContent=await(0,_str.get_string)("type_rule","local_notificationsagent"),shareItemTag.classList.remove("shared"),shareItemText=await(0,_str.get_string)("editrule_sharerule","local_notificationsagent"),shareItem.setAttribute(selectors_shareRuleDataShared,SHARING_TYPE_UNSHARED),shareItemIcon.className="fa fa-link mr-2",shareItemMessage=await(0,_str.get_string)("unshareaccept","local_notificationsagent")):(shareItemTag.textContent=await(0,_str.get_string)("type_sharedrule","local_notificationsagent"),shareItemTag.classList.add("shared"),shareItemText=await(0,_str.get_string)("editrule_unsharerule","local_notificationsagent"),shareItem.setAttribute(selectors_shareRuleDataShared,SHARING_TYPE_SHARED),shareItemIcon.className="fa fa-chain-broken mr-2",shareItemMessage=await(0,_str.get_string)("shareaccept","local_notificationsagent")),shareItem.innerHTML="",shareItem.appendChild(shareItemIcon),shareItem.appendChild(document.createTextNode(shareItemText)),_notification.default.addNotification({message:shareItemMessage,type:"info"})}else _notification.default.addNotification({message:response.warnings[0].message,type:"error"})}catch(exception){_notification.default.exception(exception)}}}));

//# sourceMappingURL=share.min.js.map